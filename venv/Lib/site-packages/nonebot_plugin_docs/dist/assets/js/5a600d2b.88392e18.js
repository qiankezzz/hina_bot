"use strict";(self.webpackChunknonebot=self.webpackChunknonebot||[]).push([[5452],{35318:function(e,n,t){t.r(n),t.d(n,{MDXContext:function(){return p},MDXProvider:function(){return u},mdx:function(){return N},useMDXComponents:function(){return s},withMDXComponents:function(){return d}});var a=t(27378);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function m(){return m=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},m.apply(this,arguments)}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},m=Object.keys(e);for(a=0;a<m.length;a++)t=m[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var m=Object.getOwnPropertySymbols(e);for(a=0;a<m.length;a++)t=m[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var p=a.createContext({}),d=function(e){return function(n){var t=s(n.components);return a.createElement(e,m({},n,{components:t}))}},s=function(e){var n=a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},u=function(e){var n=s(e.components);return a.createElement(p.Provider,{value:n},e.children)},c={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},x=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,m=e.originalType,i=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=s(t),u=r,x=d["".concat(i,".").concat(u)]||d[u]||c[u]||m;return t?a.createElement(x,o(o({ref:n},p),{},{components:t})):a.createElement(x,o({ref:n},p))}));function N(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var m=t.length,i=new Array(m);i[0]=x;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var p=2;p<m;p++)i[p]=t[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}x.displayName="MDXCreateElement"},17362:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return o},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return d},default:function(){return u}});var a=t(25773),r=t(30808),m=(t(27378),t(35318)),i=["components"],o={sidebar_position:11,description:"\u90e8\u7f72\u4f60\u7684\u673a\u5668\u4eba"},l="\u90e8\u7f72",p={unversionedId:"tutorial/deployment",id:"tutorial/deployment",isDocsHomePage:!1,title:"\u90e8\u7f72",description:"\u90e8\u7f72\u4f60\u7684\u673a\u5668\u4eba",source:"@site/docs/tutorial/deployment.md",sourceDirName:"tutorial",slug:"/tutorial/deployment",permalink:"/website/docs/next/tutorial/deployment",editUrl:"https://github.com/nonebot/nonebot2/edit/master/website/docs/tutorial/deployment.md",tags:[],version:"current",lastUpdatedBy:"github-actions[bot]",lastUpdatedAt:1674375446,formattedLastUpdatedAt:"2023/1/22",sidebarPosition:11,frontMatter:{sidebar_position:11,description:"\u90e8\u7f72\u4f60\u7684\u673a\u5668\u4eba"},sidebar:"tutorial",previous:{title:"\u6dfb\u52a0\u81ea\u5b9a\u4e49 API",permalink:"/website/docs/next/tutorial/add-custom-api"},next:{title:"\u81ea\u5b9a\u4e49\u65e5\u5fd7",permalink:"/website/docs/next/tutorial/custom-logger"}},d=[{value:"\u90e8\u7f72\u524d\u51c6\u5907",id:"\u90e8\u7f72\u524d\u51c6\u5907",children:[],level:2},{value:"\u4f7f\u7528 Docker \u90e8\u7f72\uff08\u63a8\u8350\uff09",id:"\u4f7f\u7528-docker-\u90e8\u7f72\u63a8\u8350",children:[{value:"\u7f16\u8bd1\u955c\u50cf\u4e0e\u90e8\u7f72\u914d\u7f6e",id:"\u7f16\u8bd1\u955c\u50cf\u4e0e\u90e8\u7f72\u914d\u7f6e",children:[],level:3},{value:"CI/CD",id:"cicd",children:[],level:3}],level:2},{value:"\u4f7f\u7528 Supervisor \u90e8\u7f72",id:"\u4f7f\u7528-supervisor-\u90e8\u7f72",children:[],level:2},{value:"\u4f7f\u7528 PM2 \u90e8\u7f72",id:"\u4f7f\u7528-pm2-\u90e8\u7f72",children:[{value:"\u5b89\u88c5 PM2",id:"\u5b89\u88c5-pm2",children:[],level:3},{value:"\u5728\u540e\u53f0\u8fd0\u884c\u8fdb\u7a0b",id:"\u5728\u540e\u53f0\u8fd0\u884c\u8fdb\u7a0b",children:[{value:"\u542f\u52a8 Bot \u8fdb\u7a0b",id:"\u542f\u52a8-bot-\u8fdb\u7a0b",children:[],level:4},{value:"\u5e38\u7528\u547d\u4ee4",id:"\u5e38\u7528\u547d\u4ee4",children:[],level:4}],level:3}],level:2}],s={toc:d};function u(e){var n=e.components,t=(0,r.Z)(e,i);return(0,m.mdx)("wrapper",(0,a.Z)({},s,t,{components:n,mdxType:"MDXLayout"}),(0,m.mdx)("h1",{id:"\u90e8\u7f72"},"\u90e8\u7f72"),(0,m.mdx)("p",null,"\u5728\u7f16\u5199\u5b8c\u6210\u540e\uff0c\u4f60\u9700\u8981\u90e8\u7f72\u4f60\u7684\u673a\u5668\u4eba\u6765\u4f7f\u5f97\u7528\u6237\u80fd\u591f\u4f7f\u7528\u5b83\u3002\u901a\u5e38\uff0c\u4f1a\u5c06\u673a\u5668\u4eba\u90e8\u7f72\u5728\u670d\u52a1\u5668\u4e0a\uff0c\u6765\u4fdd\u8bc1\u670d\u52a1\u6301\u4e45\u8fd0\u884c\u3002"),(0,m.mdx)("p",null,"\u5728\u5f00\u53d1\u65f6\u673a\u5668\u4eba\u8fd0\u884c\u7684\u73af\u5883\u79f0\u4e3a\u5f00\u53d1\u73af\u5883\uff0c\u800c\u5728\u90e8\u7f72\u540e\u673a\u5668\u4eba\u8fd0\u884c\u7684\u73af\u5883\u79f0\u4e3a\u751f\u4ea7\u73af\u5883\u3002\u4e0e\u5f00\u53d1\u73af\u5883\u4e0d\u540c\u7684\u662f\uff0c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u5f00\u53d1\u8005\u901a\u5e38\u4e0d\u80fd\u968f\u610f\u5730\u4fee\u6539/\u6dfb\u52a0/\u5220\u9664\u4ee3\u7801\uff0c\u5f00\u542f\u6216\u505c\u6b62\u670d\u52a1\u3002"),(0,m.mdx)("h2",{id:"\u90e8\u7f72\u524d\u51c6\u5907"},"\u90e8\u7f72\u524d\u51c6\u5907"),(0,m.mdx)("p",null,"\u5728\u751f\u4ea7\u73af\u5883\u4e2d\uff0c\u4e3a\u786e\u4fdd\u673a\u5668\u4eba\u80fd\u591f\u6b63\u5e38\u8fd0\u884c\uff0c\u4f60\u9700\u8981\u56fa\u5b9a\u4f60\u7684\u4f9d\u8d56\u5e93\u7248\u672c\u3002\u4e0b\u9762\u63d0\u4f9b\u4e86\u51e0\u79cd\u5e38\u89c1\u7684\u6587\u4ef6\u683c\u5f0f\u4e0e\u751f\u6210\u65b9\u5f0f\uff1a"),(0,m.mdx)("ul",null,(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("inlineCode",{parentName:"p"},"poetry.lock")),(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("a",{parentName:"p",href:"https://python-poetry.org/"},"poetry")," \u4f9d\u8d56\u7ba1\u7406\u5de5\u5177\u4f7f\u7528\u7684 lock \u6587\u4ef6\uff0c\u901a\u5e38\u4f1a\u5728\u5b89\u88c5\u4f9d\u8d56\u65f6\u81ea\u52a8\u751f\u6210\uff0c\u6216\u8005\u4f7f\u7528 ",(0,m.mdx)("inlineCode",{parentName:"p"},"poetry lock")," \u6765\u751f\u6210\u3002")),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("inlineCode",{parentName:"p"},"pdm.lock")),(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("a",{parentName:"p",href:"https://pdm.fming.dev/"},"pdm")," \u4f9d\u8d56\u7ba1\u7406\u5de5\u5177\u4f7f\u7528\u7684 lock \u6587\u4ef6\uff0c\u901a\u5e38\u4f1a\u5728\u5b89\u88c5\u4f9d\u8d56\u65f6\u81ea\u52a8\u751f\u6210\uff0c\u6216\u8005\u4f7f\u7528 ",(0,m.mdx)("inlineCode",{parentName:"p"},"pdm lock")," \u6765\u751f\u6210\u3002")),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("inlineCode",{parentName:"p"},"Pipfile.lock")),(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("a",{parentName:"p",href:"https://pipenv.pypa.io/en/latest/"},"Pipenv")," \u4f9d\u8d56\u7ba1\u7406\u5de5\u5177\u4f7f\u7528\u7684 lock \u6587\u4ef6\uff0c\u901a\u5e38\u4f1a\u5728\u5b89\u88c5\u4f9d\u8d56\u65f6\u81ea\u52a8\u751f\u6210\uff0c\u6216\u8005\u4f7f\u7528 ",(0,m.mdx)("inlineCode",{parentName:"p"},"pipenv lock")," \u6765\u751f\u6210\u3002")),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},(0,m.mdx)("inlineCode",{parentName:"p"},"requirements.txt")),(0,m.mdx)("p",{parentName:"li"},"\u5982\u679c\u4f60\u672a\u4f7f\u7528\u4efb\u4f55\u4f9d\u8d56\u7ba1\u7406\u5de5\u5177\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 ",(0,m.mdx)("inlineCode",{parentName:"p"},"pip freeze")," \u6765\u751f\u6210\u8fd9\u4e2a\u6587\u4ef6\u3002"))),(0,m.mdx)("h2",{id:"\u4f7f\u7528-docker-\u90e8\u7f72\u63a8\u8350"},"\u4f7f\u7528 Docker \u90e8\u7f72\uff08\u63a8\u8350\uff09"),(0,m.mdx)("p",null,"\u8bf7\u81ea\u884c\u53c2\u8003 ",(0,m.mdx)("a",{parentName:"p",href:"https://docs.docker.com/engine/install/"},"Docker \u5b98\u65b9\u6587\u6863")," \u5b89\u88c5 Docker\u3002"),(0,m.mdx)("p",null,"\u5728\u751f\u4ea7\u73af\u5883\u5b89\u88c5 ",(0,m.mdx)("a",{parentName:"p",href:"https://docs.docker.com/compose/"},"docker-compose")," \u5de5\u5177\u4ee5\u4fbf\u90e8\u7f72\u673a\u5668\u4eba\u3002"),(0,m.mdx)("h3",{id:"\u7f16\u8bd1\u955c\u50cf\u4e0e\u90e8\u7f72\u914d\u7f6e"},"\u7f16\u8bd1\u955c\u50cf\u4e0e\u90e8\u7f72\u914d\u7f6e"),(0,m.mdx)("p",null,"\u5728\u9879\u76ee\u76ee\u5f55\u4e0b\u6dfb\u52a0\u4ee5\u4e0b\u4e24\u4e2a\u6587\u4ef6\uff08\u4ee5 poetry \u548c FastAPI \u9a71\u52a8\u5668\u4e3a\u4f8b\uff09\uff1a"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-dockerfile",metastring:"title=Dockerfile",title:"Dockerfile"},'FROM python:3.9 as requirements-stage\n\nWORKDIR /tmp\n\nCOPY ./pyproject.toml ./poetry.lock* /tmp/\n\nRUN curl -sSL https://install.python-poetry.org -o install-poetry.py\n\nRUN python install-poetry.py --yes\n\nENV PATH="${PATH}:/root/.local/bin"\n\nRUN poetry export -f requirements.txt --output requirements.txt --without-hashes\n\nFROM tiangolo/uvicorn-gunicorn-fastapi:python3.9\n\nWORKDIR /app\n\nCOPY --from=requirements-stage /tmp/requirements.txt /app/requirements.txt\n\nRUN pip install --no-cache-dir --upgrade -r requirements.txt\n\nRUN rm requirements.txt\n\nCOPY ./ /app/\n')),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-yaml",metastring:"title=docker-compose.yml",title:"docker-compose.yml"},'version: "3"\nservices:\n  nonebot:\n    build: .\n    ports:\n      - "8080:8080" # \u6620\u5c04\u7aef\u53e3\u5230\u5bbf\u4e3b\u673a \u5bbf\u4e3b\u673a\u7aef\u53e3:\u5bb9\u5668\u7aef\u53e3\n    env_file:\n      - ".env.prod" # fastapi \u4f7f\u7528\u7684\u73af\u5883\u53d8\u91cf\u6587\u4ef6\n    environment:\n      - ENVIRONMENT=prod\n      - APP_MODULE=bot:app\n      - MAX_WORKERS=1\n    network_mode: bridge\n')),(0,m.mdx)("p",null,"\u914d\u7f6e\u5b8c\u6210\u540e\u5373\u53ef\u4f7f\u7528 ",(0,m.mdx)("inlineCode",{parentName:"p"},"docker-compose up -d")," \u547d\u4ee4\u6765\u542f\u52a8\u673a\u5668\u4eba\u5e76\u5728\u540e\u53f0\u8fd0\u884c\u3002"),(0,m.mdx)("h3",{id:"cicd"},"CI/CD"),(0,m.mdx)("p",null,"\u914d\u5408 GitHub Actions \u53ef\u4ee5\u5b8c\u6210 CI/CD\uff0c\u5728 GitHub \u4e0a\u53d1\u5e03 Release \u65f6\u81ea\u52a8\u90e8\u7f72\u81f3\u751f\u4ea7\u73af\u5883\u3002"),(0,m.mdx)("p",null,"\u5728 ",(0,m.mdx)("a",{parentName:"p",href:"https://hub.docker.com/"},"Docker Hub")," \u4e0a\u521b\u5efa\u4ed3\u5e93\uff0c\u5e76\u5c06\u4e0b\u65b9 workflow \u6587\u4ef6\u4e2d\u9ad8\u4eae\u884c\u4e2d\u7684\u4ed3\u5e93\u540d\u79f0\u66ff\u6362\u4e3a\u4f60\u7684\u4ed3\u5e93\u540d\u79f0\u3002"),(0,m.mdx)("p",null,"\u524d\u5f80\u9879\u76ee\u4ed3\u5e93\u7684 ",(0,m.mdx)("inlineCode",{parentName:"p"},"Settings")," > ",(0,m.mdx)("inlineCode",{parentName:"p"},"Secrets")," > ",(0,m.mdx)("inlineCode",{parentName:"p"},"actions")," \u680f\u76ee ",(0,m.mdx)("inlineCode",{parentName:"p"},"New Repository Secret")," \u6dfb\u52a0\u90e8\u7f72\u6240\u9700\u7684\u5bc6\u94a5\uff1a"),(0,m.mdx)("ul",null,(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"DOCKERHUB_USERNAME"),": \u4f60\u7684 Docker Hub \u7528\u6237\u540d"),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"DOCKERHUB_PASSWORD"),": \u4f60\u7684 Docker Hub PAT\uff08",(0,m.mdx)("a",{parentName:"li",href:"https://docs.docker.com/docker-hub/access-tokens/"},"\u521b\u5efa\u65b9\u6cd5"),"\uff09"),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"DEPLOY_HOST"),": \u90e8\u7f72\u670d\u52a1\u5668\u7684 SSH \u5730\u5740"),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"DEPLOY_USER"),": \u90e8\u7f72\u670d\u52a1\u5668\u7528\u6237\u540d"),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"DEPLOY_KEY"),": \u90e8\u7f72\u670d\u52a1\u5668\u79c1\u94a5 (",(0,m.mdx)("a",{parentName:"li",href:"https://github.com/appleboy/ssh-action#setting-up-a-ssh-key"},"\u521b\u5efa\u65b9\u6cd5"),")"),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"DEPLOY_PATH"),": \u90e8\u7f72\u670d\u52a1\u5668\u4e0a\u7684\u9879\u76ee\u8def\u5f84")),(0,m.mdx)("p",null,"\u5c06\u4ee5\u4e0b\u6587\u4ef6\u6dfb\u52a0\u81f3\u9879\u76ee\u4e0b\u7684 ",(0,m.mdx)("inlineCode",{parentName:"p"},".github/workflows/")," \u76ee\u5f55\u4e0b\uff1a"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-yaml",metastring:"title=.github/workflows/build.yml {30}",title:".github/workflows/build.yml","{30}":!0},'name: Docker Hub Release\n\non:\n  push:\n    tags:\n      - "v*"\n\njobs:\n  docker:\n    runs-on: ubuntu-latest\n\n    steps:\n      - name: Checkout\n        uses: actions/checkout@v2\n\n      - name: Setup Docker\n        uses: docker/setup-buildx-action@v1\n\n      - name: Login to DockerHub\n        uses: docker/login-action@v1\n        with:\n          username: ${{ secrets.DOCKERHUB_USERNAME }}\n          password: ${{ secrets.DOCKERHUB_PASSWORD }}\n\n      - name: Generate Tags\n        uses: docker/metadata-action@v3\n        id: metadata\n        with:\n          images: |\n            {organization}/{repository}\n          tags: |\n            type=semver,pattern={{version}}\n            type=sha\n\n      - name: Build and Publish\n        uses: docker/build-push-action@v2\n        with:\n          context: .\n          push: true\n          tags: ${{ steps.metadata.outputs.tags }}\n          labels: ${{ steps.metadata.outputs.labels }}\n')),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-yaml",metastring:"title=.github/workflows/deploy.yml",title:".github/workflows/deploy.yml"},"name: Deploy\n\non:\n  workflow_run:\n    workflows:\n      - Docker Hub Release\n    types:\n      - completed\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    if: ${{ github.event.workflow_run.conclusion == 'success' }}\n    steps:\n      - name: start deployment\n        uses: bobheadxi/deployments@v1\n        id: deployment\n        with:\n          step: start\n          token: ${{ secrets.GITHUB_TOKEN }}\n          env: official-bot\n\n      - name: remote ssh command\n        uses: appleboy/ssh-action@master\n        env:\n          DEPLOY_PATH: ${{ secrets.DEPLOY_PATH }}\n        with:\n          host: ${{ secrets.DEPLOY_HOST }}\n          username: ${{ secrets.DEPLOY_USER }}\n          key: ${{ secrets.DEPLOY_KEY }}\n          envs: DEPLOY_PATH\n          script: |\n            cd $DEPLOY_PATH\n            docker-compose down\n            docker-compose pull\n            docker-compose up -d\n\n      - name: update deployment status\n        uses: bobheadxi/deployments@v0.6.2\n        if: always()\n        with:\n          step: finish\n          token: ${{ secrets.GITHUB_TOKEN }}\n          status: ${{ job.status }}\n          deployment_id: ${{ steps.deployment.outputs.deployment_id }}\n")),(0,m.mdx)("p",null,"\u5c06\u4e0a\u4e00\u90e8\u5206\u7684 ",(0,m.mdx)("inlineCode",{parentName:"p"},"docker-compose.yml")," \u6587\u4ef6\u4ee5\u53ca ",(0,m.mdx)("inlineCode",{parentName:"p"},".env.prod")," \u914d\u7f6e\u6587\u4ef6\u6dfb\u52a0\u81f3 ",(0,m.mdx)("inlineCode",{parentName:"p"},"DEPLOY_PATH")," \u76ee\u5f55\u4e0b\uff0c\u5e76\u4fee\u6539 ",(0,m.mdx)("inlineCode",{parentName:"p"},"docker-compose.yml")," \u6587\u4ef6\u4e2d\u7684\u955c\u50cf\u914d\u7f6e\uff0c\u66ff\u6362\u4e3a Docker Hub \u7684\u4ed3\u5e93\u540d\u79f0\u3002"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-diff"},"- build: .\n+ image: {organization}/{repository}:latest\n")),(0,m.mdx)("h2",{id:"\u4f7f\u7528-supervisor-\u90e8\u7f72"},"\u4f7f\u7528 Supervisor \u90e8\u7f72"),(0,m.mdx)("p",null,"\u53c2\u8003\uff1a",(0,m.mdx)("a",{parentName:"p",href:"https://www.uvicorn.org/deployment/#supervisor"},"Uvicorn - Supervisor")),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-ini"},"[supervisord]\n\n[fcgi-program:nonebot]\nsocket=tcp://localhost:8080\ncommand=python3 -m uvicorn --fd 0 bot:app\ndirectory=/path/to/bot\nautorestart=true\nstartsecs=10\nstartretries=3\nnumprocs=1\nprocess_name=%(program_name)s-%(process_num)d\nstdout_logfile=/path/to/log/nonebot.out.log\nstdout_logfile_maxbytes=2MB\n")),(0,m.mdx)("div",{className:"admonition admonition-warning alert alert--danger"},(0,m.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,m.mdx)("h5",{parentName:"div"},(0,m.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,m.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,m.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"\u8b66\u544a")),(0,m.mdx)("div",{parentName:"div",className:"admonition-content"},(0,m.mdx)("p",{parentName:"div"},"\u8bf7\u914d\u5408\u865a\u62df\u73af\u5883\u4f7f\u7528\uff0c\u5982 venv \u7b49\uff0c\u8bf7\u52ff\u76f4\u63a5\u5728 Linux \u670d\u52a1\u5668\u7cfb\u7edf\u73af\u5883\u4e2d\u5b89\u88c5\u3002"))),(0,m.mdx)("h2",{id:"\u4f7f\u7528-pm2-\u90e8\u7f72"},"\u4f7f\u7528 PM2 \u90e8\u7f72"),(0,m.mdx)("div",{className:"admonition admonition-tip alert alert--success"},(0,m.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,m.mdx)("h5",{parentName:"div"},(0,m.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,m.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,m.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,m.mdx)("div",{parentName:"div",className:"admonition-content"},(0,m.mdx)("p",{parentName:"div"},"\u5728\u9605\u8bfb\u8fd9\u4e00\u8282\u7684\u8fc7\u7a0b\u4e2d, \u4f60\u603b\u662f\u53ef\u4ee5\u53c2\u7167 ",(0,m.mdx)("a",{parentName:"p",href:"https://pm2.keymetrics.io/docs/usage/quick-start/"},"PM2 \u5b98\u65b9\u6587\u6863")," \u6765\u5f97\u5230\u66f4\u591a\u7684\u4fe1\u606f"))),(0,m.mdx)("h3",{id:"\u5b89\u88c5-pm2"},"\u5b89\u88c5 PM2"),(0,m.mdx)("p",null,"\u9700\u8981\u6709 NodeJS 10+\u73af\u5883\u6765\u8fd0\u884c PM2, ",(0,m.mdx)("del",{parentName:"p"},"(\u4ec0\u4e48 NTR)")),(0,m.mdx)("p",null,"\u7136\u540e\u901a\u8fc7\u4ee5\u4e0b\u547d\u4ee4\u5b89\u88c5\u5373\u53ef:"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-shell"},"npm install -g pm2\n")),(0,m.mdx)("p",null,"\u5728\u5b89\u88c5\u5b8c\u6210\u540e, \u6267\u884c\u4ee5\u4e0b\u6307\u4ee4, \u5982\u679c\u5f97\u5230\u7c7b\u4f3c\u7684\u8f93\u51fa\u5219\u8bf4\u660e\u4f60\u5b89\u88c5\u6210\u529f\u4e86 PM2:"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-shell"},"$ pm2 -V\n5.2.0\n")),(0,m.mdx)("h3",{id:"\u5728\u540e\u53f0\u8fd0\u884c\u8fdb\u7a0b"},"\u5728\u540e\u53f0\u8fd0\u884c\u8fdb\u7a0b"),(0,m.mdx)("div",{className:"admonition admonition-tip alert alert--success"},(0,m.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,m.mdx)("h5",{parentName:"div"},(0,m.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,m.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,m.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,m.mdx)("div",{parentName:"div",className:"admonition-content"},(0,m.mdx)("p",{parentName:"div"},"\u4ee5\u4e0b\u6b65\u9aa4\u8981\u6c42\u60a8\u5728\u60a8 Bot \u7684\u5de5\u4f5c\u76ee\u5f55\u4e0b\u6267\u884c"),(0,m.mdx)("p",{parentName:"div"},"\u5982\u679c\u60a8\u4f7f\u7528\u4e86\u865a\u62df\u73af\u5883, \u8bf7\u786e\u4fdd Bot \u542f\u52a8\u547d\u4ee4\u80fd\u5728\u865a\u62df\u73af\u5883\u4e2d\u6b63\u5e38\u6267\u884c"),(0,m.mdx)("p",{parentName:"div"},"\u6362\u8a00\u4e4b, Bot \u7a0b\u5e8f\u9700\u8981\u5728\u5f53\u524d\u7ec8\u7aef\u73af\u5883\u4e0b\u6b63\u5e38\u8fd0\u884c"))),(0,m.mdx)("h4",{id:"\u542f\u52a8-bot-\u8fdb\u7a0b"},"\u542f\u52a8 Bot \u8fdb\u7a0b"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-shell"},'$ pm2 start "python -m nb_cli run" # \u6216\u8005\u76f4\u63a5 nb run \u4e5f\u884c\n\n[PM2] Starting /usr/bin/bash in fork_mode (1 instance)\n[PM2] Done.\n\u250c\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 id  \u2502 name   \u2502 namespace   \u2502 version \u2502 mode    \u2502 pid      \u2502 uptime \u2502 \u21ba    \u2502 status    \u2502 cpu      \u2502 mem      \u2502 user     \u2502 watching \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 0   \u2502 nb run \u2502 default     \u2502 N/A     \u2502 fork    \u2502 93061    \u2502 0s     \u2502 0    \u2502 online    \u2502 0%       \u2502 8.3mb    \u2502 mix      \u2502 disabled \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n')),(0,m.mdx)("p",null,"\u6b64\u65f6 Bot \u8fdb\u7a0b\u5c31\u5728\u540e\u53f0\u8fd0\u884c\u4e86, \u6ce8\u610f\u5230\u8868\u683c\u7b2c\u4e00\u5217\u7684 ID, \u5b83\u53ef\u4ee5\u7528\u6765\u67e5\u770b\u548c\u63a7\u5236\u8fdb\u7a0b\u7684\u72b6\u6001"),(0,m.mdx)("h4",{id:"\u5e38\u7528\u547d\u4ee4"},"\u5e38\u7528\u547d\u4ee4"),(0,m.mdx)("p",null,"\u66f4\u5177\u4f53\u7684\u7528\u6cd5\u8bf7\u79fb\u6b65 PM2 \u5b98\u65b9\u6587\u6863, ",(0,m.mdx)("del",{parentName:"p"},"\u5982\u679c\u60f3\u8981\u8be6\u7ec6\u793a\u4f8b\u5efa\u8bae\u76f4\u63a5\u4e0a\u624b\u8bd5\u8bd5")),(0,m.mdx)("p",null,"\u5176\u4e2d\u547d\u4ee4\u4e2d\u7684\u6240\u6709",(0,m.mdx)("inlineCode",{parentName:"p"},"<id>"),"\u5e94\u8be5\u66ff\u6362\u4e3a\u4e0a\u6587\u542f\u52a8\u8fdb\u7a0b\u540e\u8fd4\u56de\u7684 ID"),(0,m.mdx)("ul",null,(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u67e5\u770b\u6700\u8fd1 150 \u884c\u65e5\u5fd7"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 log <id> --lines 150")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u5b9e\u65f6\u76d1\u63a7\u6240\u6709\u8fdb\u7a0b\u65e5\u5fd7"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 monit")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u5c55\u793a\u5f53\u524d PM2 \u7ba1\u7406\u7684\u6240\u6709\u8fdb\u7a0b"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 ls")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u505c\u6b62\u67d0\u4e2a\u8fdb\u7a0b"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 stop <id>")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u5220\u9664\u67d0\u4e2a\u8fdb\u7a0b"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 del <id>")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u91cd\u542f\u67d0\u4e2a\u8fdb\u7a0b"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 restart <id>")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u4fdd\u5b58\u5f53\u524d\u8fdb\u7a0b\u5217\u8868"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 save")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u6062\u590d\u4fdd\u5b58\u7684\u8fdb\u7a0b\u5217\u8868"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 resurrect")))),(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("p",{parentName:"li"},"\u8bbe\u7f6e\u5f00\u673a\u81ea\u52a8\u542f\u52a8\u8fdb\u7a0b\u5217\u8868"),(0,m.mdx)("ul",{parentName:"li"},(0,m.mdx)("li",{parentName:"ul"},(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 startup")),(0,m.mdx)("li",{parentName:"ul"},"\u9700\u8981\u6267\u884c\u8fc7 ",(0,m.mdx)("inlineCode",{parentName:"li"},"pm2 save"),(0,m.mdx)("br",{parentName:"li"}),"\u5982\u679c\u4e0d\u662f root \u7528\u6237\u6267\u884c, \u5219\u9700\u8981\u624b\u52a8\u6dfb\u52a0\u6307\u4ee4\u8fd4\u56de\u7684\u73af\u5883\u53d8\u91cf")))))}u.isMDXComponent=!0}}]);