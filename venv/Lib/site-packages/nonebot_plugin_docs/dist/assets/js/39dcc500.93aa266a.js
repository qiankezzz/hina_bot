"use strict";(self.webpackChunknonebot=self.webpackChunknonebot||[]).push([[9099],{35318:function(e,n,t){t.r(n),t.d(n,{MDXContext:function(){return d},MDXProvider:function(){return l},mdx:function(){return x},useMDXComponents:function(){return c},withMDXComponents:function(){return p}});var a=t(27378);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(){return o=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},o.apply(this,arguments)}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function m(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,r=function(e,n){if(null==e)return{};var t,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(r[t]=e[t]);return r}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=a.createContext({}),p=function(e){return function(n){var t=c(n.components);return a.createElement(e,o({},n,{components:t}))}},c=function(e){var n=a.useContext(d),t=n;return e&&(t="function"==typeof e?e(n):m(m({},n),e)),t},l=function(e){var n=c(e.components);return a.createElement(d.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},g=a.forwardRef((function(e,n){var t=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(t),l=r,g=p["".concat(i,".").concat(l)]||p[l]||u[l]||o;return t?a.createElement(g,m(m({ref:n},d),{},{components:t})):a.createElement(g,m({ref:n},d))}));function x(e,n){var t=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var o=t.length,i=new Array(o);i[0]=g;var m={};for(var s in n)hasOwnProperty.call(n,s)&&(m[s]=n[s]);m.originalType=e,m.mdxType="string"==typeof e?e:r,i[1]=m;for(var d=2;d<o;d++)i[d]=t[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,t)}g.displayName="MDXCreateElement"},18308:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return p},contentTitle:function(){return c},metadata:function(){return l},toc:function(){return u},default:function(){return x}});var a=t(25773),r=t(30808),o=(t(27378),t(35318)),i=t(53392),m=t(28683),s=t(89156),d=["components"],p={sidebar_position:1,description:"\u4f7f\u7528 NoneBug \u6d4b\u8bd5\u673a\u5668\u4eba",slug:"/advanced/unittest/",options:{menu:{weight:70,category:"advanced"}}},c="\u5355\u5143\u6d4b\u8bd5",l={unversionedId:"advanced/unittest/README",id:"advanced/unittest/README",isDocsHomePage:!1,title:"\u5355\u5143\u6d4b\u8bd5",description:"\u4f7f\u7528 NoneBug \u6d4b\u8bd5\u673a\u5668\u4eba",source:"@site/docs/advanced/unittest/README.mdx",sourceDirName:"advanced/unittest",slug:"/advanced/unittest/",permalink:"/website/docs/next/advanced/unittest/",editUrl:"https://github.com/nonebot/nonebot2/edit/master/website/docs/advanced/unittest/README.mdx",tags:[],version:"current",lastUpdatedBy:"github-actions[bot]",lastUpdatedAt:1674375446,formattedLastUpdatedAt:"2023/1/22",sidebarPosition:1,frontMatter:{sidebar_position:1,description:"\u4f7f\u7528 NoneBug \u6d4b\u8bd5\u673a\u5668\u4eba",slug:"/advanced/unittest/",options:{menu:{weight:70,category:"advanced"}}},sidebar:"tutorial",previous:{title:"\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\u91cd\u8f7d",permalink:"/website/docs/next/advanced/di/overload"},next:{title:"\u6d4b\u8bd5\u4e8b\u4ef6\u54cd\u5e94\u548c API \u8c03\u7528",permalink:"/website/docs/next/advanced/unittest/test-matcher"}},u=[{value:"\u5b89\u88c5 NoneBug",id:"\u5b89\u88c5-nonebug",children:[],level:2},{value:"\u52a0\u8f7d\u63d2\u4ef6",id:"\u52a0\u8f7d\u63d2\u4ef6",children:[],level:2},{value:"\u6d4b\u8bd5\u6d41\u7a0b",id:"\u6d4b\u8bd5\u6d41\u7a0b",children:[],level:2},{value:"\u6d4b\u8bd5\u6837\u4f8b",id:"\u6d4b\u8bd5\u6837\u4f8b",children:[],level:2}],g={toc:u};function x(e){var n=e.components,t=(0,r.Z)(e,d);return(0,o.mdx)("wrapper",(0,a.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,o.mdx)("h1",{id:"\u5355\u5143\u6d4b\u8bd5"},"\u5355\u5143\u6d4b\u8bd5"),(0,o.mdx)("p",null,(0,o.mdx)("a",{parentName:"p",href:"https://zh.wikipedia.org/wiki/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95"},"\u5355\u5143\u6d4b\u8bd5")),(0,o.mdx)("blockquote",null,(0,o.mdx)("p",{parentName:"blockquote"},"\u5728\u8ba1\u7b97\u673a\u7f16\u7a0b\u4e2d\uff0c\u5355\u5143\u6d4b\u8bd5\uff08Unit Testing\uff09\u53c8\u79f0\u4e3a\u6a21\u5757\u6d4b\u8bd5\uff0c\u662f\u9488\u5bf9\u7a0b\u5e8f\u6a21\u5757\uff08\u8f6f\u4ef6\u8bbe\u8ba1\u7684\u6700\u5c0f\u5355\u4f4d\uff09\u6765\u8fdb\u884c\u6b63\u786e\u6027\u68c0\u9a8c\u7684\u6d4b\u8bd5\u5de5\u4f5c\u3002")),(0,o.mdx)("p",null,"NoneBot2 \u4f7f\u7528 ",(0,o.mdx)("a",{parentName:"p",href:"https://docs.pytest.org"},"Pytest")," \u5355\u5143\u6d4b\u8bd5\u6846\u67b6\u642d\u914d ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/nonebot/nonebug"},"NoneBug")," \u63d2\u4ef6\u8fdb\u884c\u5355\u5143\u6d4b\u8bd5\uff0c\u901a\u8fc7\u76f4\u63a5\u4e0e\u4e8b\u4ef6\u54cd\u5e94\u5668/\u9002\u914d\u5668\u7b49\u4ea4\u4e92\u7b80\u5316\u6d4b\u8bd5\u6d41\u7a0b\uff0c\u66f4\u6613\u4e8e\u7f16\u5199\u3002"),(0,o.mdx)("h2",{id:"\u5b89\u88c5-nonebug"},"\u5b89\u88c5 NoneBug"),(0,o.mdx)("p",null,"\u5b89\u88c5 NoneBug \u65f6\uff0cPytest \u4f1a\u4f5c\u4e3a\u4f9d\u8d56\u88ab\u4e00\u8d77\u5b89\u88c5\u3002"),(0,o.mdx)("p",null,"\u8981\u8fd0\u884c NoneBug\uff0c\u8fd8\u9700\u8981\u989d\u5916\u5b89\u88c5 Pytest \u5f02\u6b65\u63d2\u4ef6 ",(0,o.mdx)("inlineCode",{parentName:"p"},"pytest-asyncio")," \u6216 ",(0,o.mdx)("inlineCode",{parentName:"p"},"anyio"),"\uff0c\u6587\u6863\u5c06\u4ee5 ",(0,o.mdx)("inlineCode",{parentName:"p"},"pytest-asyncio")," \u4e3a\u4f8b\u3002"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"poetry add nonebug pytest-asyncio --dev\n# \u4e5f\u53ef\u4ee5\u901a\u8fc7 pip \u5b89\u88c5\npip install nonebug pytest-asyncio\n")),(0,o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,o.mdx)("h5",{parentName:"div"},(0,o.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,o.mdx)("div",{parentName:"div",className:"admonition-content"},(0,o.mdx)("p",{parentName:"div"},"\u5efa\u8bae\u9996\u5148\u9605\u8bfb ",(0,o.mdx)("a",{parentName:"p",href:"https://docs.pytest.org"},"Pytest \u6587\u6863")," \u7406\u89e3\u76f8\u5173\u672f\u8bed\u3002"))),(0,o.mdx)("h2",{id:"\u52a0\u8f7d\u63d2\u4ef6"},"\u52a0\u8f7d\u63d2\u4ef6"),(0,o.mdx)("p",null,"\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 Pytest ",(0,o.mdx)("strong",{parentName:"p"},"Fixtures")," \u6765\u52a0\u8f7d\u63d2\u4ef6\uff0c\u4e0b\u9762\u662f\u4e00\u4e2a\u793a\u4f8b\uff1a"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-python",metastring:"title=conftest.py",title:"conftest.py"},'from pathlib import Path\nfrom typing import TYPE_CHECKING, Set\n\nimport pytest\n\nif TYPE_CHECKING:\n    from nonebot.plugin import Plugin\n\n\n@pytest.fixture\ndef load_plugins(nonebug_init: None) -> Set["Plugin"]:\n    import nonebot  # \u8fd9\u91cc\u7684\u5bfc\u5165\u5fc5\u987b\u5728\u51fd\u6570\u5185\n\n    # \u52a0\u8f7d\u63d2\u4ef6\n    return nonebot.load_plugins("awesome_bot/plugins")\n')),(0,o.mdx)("p",null,"\u6b64 Fixture \u7684 ",(0,o.mdx)("a",{parentName:"p",href:"https://github.com/nonebot/nonebug/blob/master/nonebug/fixture.py"},(0,o.mdx)("inlineCode",{parentName:"a"},"nonebug_init"))," \u5f62\u53c2\u4e5f\u662f\u4e00\u4e2a Fixture\uff0c\u7528\u4e8e\u521d\u59cb\u5316 NoneBug\u3002"),(0,o.mdx)("p",null,"Fixture \u540d\u79f0 ",(0,o.mdx)("inlineCode",{parentName:"p"},"load_plugins")," \u53ef\u4ee5\u4fee\u6539\u4e3a\u5176\u4ed6\u540d\u79f0\uff0c\u6587\u6863\u4ee5 ",(0,o.mdx)("inlineCode",{parentName:"p"},"load_plugins")," \u4e3a\u4f8b\u3002\u9700\u8981\u52a0\u8f7d\u63d2\u4ef6\u65f6\uff0c\u5728\u6d4b\u8bd5\u51fd\u6570\u6dfb\u52a0\u5f62\u53c2 ",(0,o.mdx)("inlineCode",{parentName:"p"},"load_plugins")," \u5373\u53ef\u3002\u52a0\u8f7d\u5b8c\u6210\u540e\u5373\u53ef\u4f7f\u7528 ",(0,o.mdx)("inlineCode",{parentName:"p"},"import")," \u5bfc\u5165\u4e8b\u4ef6\u54cd\u5e94\u5668\u3002"),(0,o.mdx)("h2",{id:"\u6d4b\u8bd5\u6d41\u7a0b"},"\u6d4b\u8bd5\u6d41\u7a0b"),(0,o.mdx)("p",null,"Pytest \u4f1a\u5728\u51fd\u6570\u5f00\u59cb\u524d\u901a\u8fc7 Fixture ",(0,o.mdx)("inlineCode",{parentName:"p"},"app"),"(nonebug_app) ",(0,o.mdx)("strong",{parentName:"p"},"\u521d\u59cb\u5316 NoneBug")," \u5e76\u8fd4\u56de ",(0,o.mdx)("inlineCode",{parentName:"p"},"App")," \u5bf9\u8c61\u3002"),(0,o.mdx)("div",{className:"admonition admonition-warning alert alert--danger"},(0,o.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,o.mdx)("h5",{parentName:"div"},(0,o.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"\u8b66\u544a")),(0,o.mdx)("div",{parentName:"div",className:"admonition-content"},(0,o.mdx)("p",{parentName:"div"},"\u6240\u6709\u4ece ",(0,o.mdx)("inlineCode",{parentName:"p"},"nonebot")," \u5bfc\u5165\u6a21\u5757\u7684\u51fd\u6570\u90fd\u9700\u8981\u9996\u5148\u521d\u59cb\u5316 NoneBug App\uff0c\u5426\u5219\u4f1a\u53d1\u751f\u4e0d\u53ef\u9884\u6599\u7684\u95ee\u9898\u3002"),(0,o.mdx)("p",{parentName:"div"},"\u5728\u6bcf\u4e2a\u6d4b\u8bd5\u51fd\u6570\u7ed3\u675f\u65f6\uff0cNoneBug \u4f1a\u81ea\u52a8\u9500\u6bc1\u6240\u6709\u4e0e NoneBot \u76f8\u5173\u7684\u8d44\u6e90\u3002\u6240\u6709\u4e0e NoneBot \u76f8\u5173\u7684 import \u5e94\u5728\u51fd\u6570\u5185\u8fdb\u884c\u5bfc\u5165\u3002"))),(0,o.mdx)("p",null,"\u968f\u540e\u4f7f\u7528 ",(0,o.mdx)("inlineCode",{parentName:"p"},"test_matcher")," \u7b49\u6d4b\u8bd5\u65b9\u6cd5\u83b7\u53d6\u5230 ",(0,o.mdx)("inlineCode",{parentName:"p"},"Context")," \u4e0a\u4e0b\u6587\uff0c\u901a\u8fc7\u4e0a\u4e0b\u6587\u7ba1\u7406\u63d0\u4f9b\u7684\u65b9\u6cd5\uff08\u5982 ",(0,o.mdx)("inlineCode",{parentName:"p"},"should_call_send")," \u7b49\uff09\u9884\u5b9a\u4e49\u884c\u4e3a\u3002"),(0,o.mdx)("p",null,"\u5728\u4e0a\u4e0b\u6587\u7ba1\u7406\u5668\u5173\u95ed\u65f6\uff0c",(0,o.mdx)("inlineCode",{parentName:"p"},"Context")," \u4f1a\u8c03\u7528 ",(0,o.mdx)("inlineCode",{parentName:"p"},"run_test")," \u65b9\u6cd5\u6309\u7167\u9884\u5b9a\u4e49\u884c\u4e3a\u5bf9\u4e8b\u4ef6\u54cd\u5e94\u5668\u8fdb\u884c\u65ad\u8a00\uff08\u5982\uff1a\u65ad\u8a00\u4e8b\u4ef6\u54cd\u5e94\u548c API \u8c03\u7528\u7b49\uff09\u3002"),(0,o.mdx)("h2",{id:"\u6d4b\u8bd5\u6837\u4f8b"},"\u6d4b\u8bd5\u6837\u4f8b"),(0,o.mdx)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.mdx)("div",{parentName:"div",className:"admonition-heading"},(0,o.mdx)("h5",{parentName:"div"},(0,o.mdx)("span",{parentName:"h5",className:"admonition-icon"},(0,o.mdx)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.mdx)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"\u63d0\u793a")),(0,o.mdx)("div",{parentName:"div",className:"admonition-content"},(0,o.mdx)("p",{parentName:"div"},"\u5c06\u4ece ",(0,o.mdx)("inlineCode",{parentName:"p"},"utils")," \u5bfc\u5165\u7684 ",(0,o.mdx)("inlineCode",{parentName:"p"},"make_fake_message"),"\uff0c",(0,o.mdx)("inlineCode",{parentName:"p"},"make_fake_event")," \u66ff\u6362\u4e3a\u5bf9\u5e94\u5e73\u53f0\u7684\u6d88\u606f/\u4e8b\u4ef6\u7c7b\u578b\u3002"),(0,o.mdx)("p",{parentName:"div"},"\u5c06 ",(0,o.mdx)("inlineCode",{parentName:"p"},"load_example")," \u66ff\u6362\u4e3a\u52a0\u8f7d\u63d2\u4ef6\u7684 Fixture \u540d\u79f0\u3002"))),(0,o.mdx)("p",null,"\u4f7f\u7528 NoneBug \u7684 ",(0,o.mdx)("inlineCode",{parentName:"p"},"test_matcher")," \u53ef\u4ee5\u6a21\u62df\u51fa\u4e00\u4e2a\u4e8b\u4ef6\u6d41\u7a0b\u3002\u5982\u4e0b\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u793a\u4f8b\uff1a"),(0,o.mdx)(i.default,{className:"language-python",title:"test_weather.py",mdxType:"CodeBlock"},s.Z),(0,o.mdx)("details",null,(0,o.mdx)("summary",null,"\u793a\u4f8b\u63d2\u4ef6"),(0,o.mdx)(i.default,{className:"language-python",title:"examples/weather.py",mdxType:"CodeBlock"},m.Z)),(0,o.mdx)("p",null,"\u5728\u6d4b\u8bd5\u7528\u4f8b\u7f16\u5199\u5b8c\u6210\u540e \uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u8fd0\u884c\u5355\u5143\u6d4b\u8bd5\u3002"),(0,o.mdx)("pre",null,(0,o.mdx)("code",{parentName:"pre",className:"language-bash"},"pytest test_weather.py\n")))}x.isMDXComponent=!0},28683:function(e,n){n.Z='from nonebot import on_command\nfrom nonebot.rule import to_me\nfrom nonebot.matcher import Matcher\nfrom nonebot.adapters import Message\nfrom nonebot.params import Arg, CommandArg, ArgPlainText\n\nweather = on_command("weather", rule=to_me(), aliases={"\u5929\u6c14", "\u5929\u6c14\u9884\u62a5"}, priority=5)\n\n\n@weather.handle()\nasync def handle_first_receive(matcher: Matcher, args: Message = CommandArg()):\n    plain_text = args.extract_plain_text()  # \u9996\u6b21\u53d1\u9001\u547d\u4ee4\u65f6\u8ddf\u968f\u7684\u53c2\u6570\uff0c\u4f8b\uff1a/\u5929\u6c14 \u4e0a\u6d77\uff0c\u5219args\u4e3a\u4e0a\u6d77\n    if plain_text:\n        matcher.set_arg("city", args)  # \u5982\u679c\u7528\u6237\u53d1\u9001\u4e86\u53c2\u6570\u5219\u76f4\u63a5\u8d4b\u503c\n\n\n@weather.got("city", prompt="\u4f60\u60f3\u67e5\u8be2\u54ea\u4e2a\u57ce\u5e02\u7684\u5929\u6c14\u5462\uff1f")\nasync def handle_city(city: Message = Arg(), city_name: str = ArgPlainText("city")):\n    if city_name not in ["\u5317\u4eac", "\u4e0a\u6d77"]:  # \u5982\u679c\u53c2\u6570\u4e0d\u7b26\u5408\u8981\u6c42\uff0c\u5219\u63d0\u793a\u7528\u6237\u91cd\u65b0\u8f93\u5165\n        # \u53ef\u4ee5\u4f7f\u7528\u5e73\u53f0\u7684 Message \u7c7b\u76f4\u63a5\u6784\u9020\u6a21\u677f\u6d88\u606f\n        await weather.reject(city.template("\u4f60\u60f3\u67e5\u8be2\u7684\u57ce\u5e02 {city} \u6682\u4e0d\u652f\u6301\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01"))\n\n    city_weather = await get_weather(city_name)\n    await weather.finish(city_weather)\n\n\n# \u5728\u8fd9\u91cc\u7f16\u5199\u83b7\u53d6\u5929\u6c14\u4fe1\u606f\u7684\u51fd\u6570\nasync def get_weather(city: str) -> str:\n    return f"{city}\u7684\u5929\u6c14\u662f..."\n'},89156:function(e,n){n.Z='import pytest\nfrom nonebug import App\n\n\n@pytest.mark.asyncio\nasync def test_weather(app: App, load_example):\n    from examples.weather import weather\n    from utils import make_fake_event, make_fake_message\n\n    # \u5c06\u6b64\u5904\u7684 make_fake_message() \u66ff\u6362\u4e3a\u4f60\u8981\u53d1\u9001\u7684\u5e73\u53f0\u6d88\u606f Message \u7c7b\u578b\n    Message = make_fake_message()\n\n    async with app.test_matcher(weather) as ctx:\n        bot = ctx.create_bot()\n\n        msg = Message("/\u5929\u6c14 \u4e0a\u6d77")\n        # \u5c06\u6b64\u5904\u7684 make_fake_event() \u66ff\u6362\u4e3a\u4f60\u8981\u53d1\u9001\u7684\u5e73\u53f0\u4e8b\u4ef6 Event \u7c7b\u578b\n        event = make_fake_event(_message=msg, _to_me=True)()\n\n        ctx.receive_event(bot, event)\n        ctx.should_call_send(event, "\u4e0a\u6d77\u7684\u5929\u6c14\u662f...", True)\n        ctx.should_finished()\n\n    async with app.test_matcher(weather) as ctx:\n        bot = ctx.create_bot()\n\n        msg = Message("/\u5929\u6c14 \u5357\u4eac")\n        # \u5c06\u6b64\u5904\u7684 make_fake_event() \u66ff\u6362\u4e3a\u4f60\u8981\u53d1\u9001\u7684\u5e73\u53f0\u4e8b\u4ef6 Event \u7c7b\u578b\n        event = make_fake_event(_message=msg, _to_me=True)()\n\n        ctx.receive_event(bot, event)\n        ctx.should_call_send(\n            event,\n            Message.template("\u4f60\u60f3\u67e5\u8be2\u7684\u57ce\u5e02 {} \u6682\u4e0d\u652f\u6301\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01").format("\u5357\u4eac"),\n            True,\n        )\n        ctx.should_rejected()\n\n        msg = Message("\u5317\u4eac")\n        event = make_fake_event(_message=msg)()\n\n        ctx.receive_event(bot, event)\n        ctx.should_call_send(event, "\u5317\u4eac\u7684\u5929\u6c14\u662f...", True)\n        ctx.should_finished()\n\n    async with app.test_matcher(weather) as ctx:\n        bot = ctx.create_bot()\n\n        msg = Message("/\u5929\u6c14")\n        # \u5c06\u6b64\u5904\u7684 make_fake_event() \u66ff\u6362\u4e3a\u4f60\u8981\u53d1\u9001\u7684\u5e73\u53f0\u4e8b\u4ef6 Event \u7c7b\u578b\n        event = make_fake_event(_message=msg, _to_me=True)()\n\n        ctx.receive_event(bot, event)\n        ctx.should_call_send(event, "\u4f60\u60f3\u67e5\u8be2\u54ea\u4e2a\u57ce\u5e02\u7684\u5929\u6c14\u5462\uff1f", True)\n\n        msg = Message("\u676d\u5dde")\n        event = make_fake_event(_message=msg)()\n\n        ctx.receive_event(bot, event)\n        ctx.should_call_send(\n            event,\n            Message.template("\u4f60\u60f3\u67e5\u8be2\u7684\u57ce\u5e02 {} \u6682\u4e0d\u652f\u6301\uff0c\u8bf7\u91cd\u65b0\u8f93\u5165\uff01").format("\u676d\u5dde"),\n            True,\n        )\n        ctx.should_rejected()\n\n        msg = Message("\u5317\u4eac")\n        event = make_fake_event(_message=msg)()\n\n        ctx.receive_event(bot, event)\n        ctx.should_call_send(event, "\u5317\u4eac\u7684\u5929\u6c14\u662f...", True)\n        ctx.should_finished()\n'}}]);