# coding:utf-8
import datetime
import json


import nonebot

import requests

from nonebot.adapters.onebot.v11 import Message


class Utils:

    @staticmethod
    async def load_pic(num:int = 1):
        url = "https://iw233.cn/api.php?sort=random"

        params = {
            'type': 'json',
            'num': str(num),
        }
        headers = {
            "user-agent": "Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) "
                          "Chrome/94.0.4606.71 Safari/537.36 Core/1.94.186.400 QQBrowser/11.3.5195.400 "
        }
        res = requests.get(url, headers=headers, params=params)
        pic_json = res.json()
        for i in range(num):
            pic_url = pic_json['pic'][i]
            res = requests.get(pic_url)
            with open(f"D:\\hina bot\\hinabot\\data\\color_imgae\\hh{i}.png", 'wb') as f:
                f.write(res.content)

    @staticmethod
    async def write_date():
        data_dir = "D:/hina bot/hinabot/data/color_imgae/data/"
        with open(data_dir+"cd.json",'w',encoding='utf-8') as f:
            CD = datetime.datetime.now().strftime('%Y-%m-%d %H:%M:%S')
            dict = {
                "CD":str(CD)
            }
            json.dump(dict,f,indent=4)

    @staticmethod
    async def read_date() -> bool:
        data_dir = "D:/hina bot/hinabot/data/color_imgae/data/"
        with open(data_dir+"cd.json",'r',encoding='utf-8') as f:
            content = json.load(f)
        if not content:
            return True
        else:
            CD = content['CD']
            old_CD = datetime.datetime.strptime(CD,'%Y-%m-%d %H:%M:%S')
            now_CD = datetime.datetime.now()
            if (now_CD - old_CD).seconds > 20:
                return True
            return False
